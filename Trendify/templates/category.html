{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>{% block title %}Tredify-Dashboard{% endblock title %}</title>

   
   

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <!-- Vendor CSS Files -->
    <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/aos/aos.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/styles.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'assets/css/cart.css' %}">
    <link href="{% static 'assets/css/main.css' %}" rel="stylesheet" />

    <!-- jQuery (load before any scripts that use it) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    {% block style %}
    {% endblock style %}
  </head>

  <body class="index-page">
    <header id="header" class="header d-flex align-items-center fixed-top">
      <div
        class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between"
      >
        <a
          href="index.html"
          class="logo d-flex align-items-center me-auto me-lg-0"
        >
          <h1 class="sitename">TRENDIFY</h1>
          <span>.</span>
        </a>

         <nav id="navmenu" class="navmenu">
          <ul>
            <li>
              <a href="#hero" class="active">Home<br /></a>
            </li>
            <li><a href="{% url 'about' %}">About</a></li>
            <li><a href="#products">Categories</a></li>
            <li><a href="/">Order</a></li>
            <li><a href="/">Tracking</a></li>
            <li><a href="#footer">Contact</a></li>
            
          </ul>
          <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
        </nav>

    {% if request.user.is_authenticated %}

        <button type="button" class="btn btn-dark mx-2" id="popcart" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">
        Cart(<span id="cart">0</span>)</button>
        <a class="btn-getstarted" href="#">Welcome {{user.username}}</a>
        <li><a class="btn-getstarted" href="/">GoBack</a></li>
        {% else %}
        <a class="btn-getstarted" href="/auth/login">SignIn</a>
        {% endif %}
      </div>
    </header>

   <main class="main">
      <!-- Hero Section -->
      <section id="hero" class="hero section ">
     <section class="products" id="products">
  <div class="container">
    <h2 class="section-title text-center my-5">{{ category }}</h2>

    {% for category_name, products in products_by_category.items %}
      <div class="container">
        <h3 class="my-3 text-center text-success bg-light py-2">{{ category_name }}</h3>
      </div>
      <div class="row">
        {% for product in products %}
          <div class="col-md-3 mt-3">
            <div class="card product-card shadow-sm p-3 mb-5 bg-white rounded" data-aos="fade-up">
              <img src="/media/{{ product.image }}" class="card-img-top img-fluid product-image" alt="{{ product.name }}" />
              <div class="card-body text-center">
                <h5 class="card-title" id="namepr{{ product.id }}">{{ product.name }}</h5>
                <p class="card-text">{{ product.description|slice:"0:200" }}...</p>
                
                {% if not product.is_offer %}
                  <h6 class="card-price">Price: <span id="pricepr{{ product.id }}" class="text-danger">{{ product.price }}</span></h6>
                {% else %}
                  <strike>
                    <h6 class="card-price">Price: <span id="pricepr{{ product.id }}" class="text-danger">{{ product.price }}</span></h6>
                  </strike>
                  <h6 class="card-sale-price text-danger">Offer Price: <span>{{ product.offer_price }}</span></h6>
                {% endif %}
                
                {% if not product.is_stock %}
                  <p class="card-stock text-danger">Out Stock</p>
                {% else %}
                <p class="card-stock text-success">In Stock</p>
                {% endif %}
                
                <div id="divpr{{ product.id }}"></div>
                <div class="d-flex justify-content-center mt-3">
                  <button id="pr{{ product.id }}" class="btn btn-success btn-sm mx-2 add-to-cart-btn">Add To Cart</button>
                  <a href="{% url 'product' product.id %}" class="btn btn-info btn-sm mx-2 view-btn">View</a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</section>




    <footer id="footer" class="footer dark-background">
      <div class="footer-top">
        <div class="container">
          <div class="row gy-4">
            <div class="col-lg-4 col-md-6 footer-about">
              <a href="index.html" class="logo d-flex align-items-center">
                <span class="sitename">TRENDIFY.</span>
              </a>
              <div class="footer-contact pt-3">
                <p>Un-Named Street</p>
                <p>India, SomeName Of Area</p>
                <p class="mt-3">
                  <strong>Phone:</strong> <span>+91 22222 55555</span>
                </p>
                <p>
                  <strong>Email:</strong> <span>sandyddeveloper@gmail.com</span>
                </p>
              </div>
              <div class="social-links d-flex mt-4">
                <a href=""><i class="bi bi-twitter-x"></i></a>
                <a href=""><i class="bi bi-facebook"></i></a>
                <a href=""><i class="bi bi-instagram"></i></a>
                <a href=""><i class="bi bi-linkedin"></i></a>
              </div>
            </div>

            <div class="col-lg-2 col-md-3 footer-links">
              <h4>Useful Links</h4>
              <ul>
                <li>
                  <i class="bi bi-chevron-right"></i> <a href="#"> Home</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i> <a href="#"> About us</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i> <a href="#"> Services</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i>
                  <a href="#"> Terms of service</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i>
                  <a href="#"> Privacy policy</a>
                </li>
              </ul>
            </div>

            <div class="col-lg-2 col-md-3 footer-links">
              <h4>Our Services</h4>
              <ul>
                <li>
                  <i class="bi bi-chevron-right"></i>
                  <a href="#"> Web Design</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i>
                  <a href="#"> Web Development</a>
                </li>
                <li>
                  <i class="bi bi-chevron-right"></i>
                  <a href="#"> Logo Design</a>
                </li>
              </ul>
            </div>

            <div class="col-lg-4 col-md-12 footer-newsletter">
              <h4>Our Newsletter</h4>
              <p>
                Subscribe to our newsletter and receive the latest news about
                our products and services!
              </p>
              <form
                action="forms/newsletter.php"
                method="post"
                class="php-email-form"
              >
              {% csrf_token %}
                <div class="newsletter-form">
                  <input type="email" name="email" /><input
                    type="submit"
                    value="Subscribe"
                  />
                </div>
                <div class="loading">Loading</div>
                <div class="error-message"></div>
                <div class="sent-message">
                  Your subscription request has been sent. Thank you!
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="copyright">
        <div class="container text-center">
          <p>
            Â© <span>Copyright 2024</span>
            <strong class="px-1 sitename">TRENDIFY.</strong>
            <span>All Rights Reserved</span>
          </p>
          <div class="credits"></div>
        </div>
      </div>
    </footer>

    <!-- Scroll Top -->
    <a
      href="#"
      id="scroll-top"
      class="scroll-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Preloader -->
    <div id="preloader"></div>

    {% block script %}
    <script>
   $(document).ready(function() {
  let cart = localStorage.getItem('cart') ? JSON.parse(localStorage.getItem('cart')) : {};

  updateCart(cart);

  $('.add-to-cart-btn').on('click', function() {
    let idstr = this.id.toString().substring(2);

    if (cart[idstr] != undefined) {
      cart[idstr][0] += 1;
    } else {
      let qty = 1;
      let name = document.getElementById('namepr' + idstr).innerHTML;
      let price = document.getElementById('pricepr' + idstr).innerHTML;
      cart[idstr] = [qty, name, price];
    }
    
    updateCart(cart);
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = Object.keys(cart).length;
  });

  function updateCart(cart) {
    var sum = 0;
    for (var item in cart) {
      sum += cart[item][0];
      
      // Log the ID to ensure it is correct
      console.log('Attempting to update element with ID:', 'divpr' + item);
      
      // Check if the element exists before setting its innerHTML
      let divprElement = document.getElementById('divpr' + item);
      if (divprElement) {
        divprElement.innerHTML = `
          <button id="minus${item}" class="btn btn-primary minus">-</button>
          <span class="mx-2">${cart[item][0]}</span>
          <button id="plus${item}" class="btn btn-primary plus">+</button>`;
      } else {
        console.error(`Element with ID divpr${item} not found`);
      }
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = sum;

    addEventListeners();
    updatePopover(cart);
  }

  function addEventListeners() {
    $('.minus').on('click', function() {
      let id = this.id.replace('minus', '');
      if (cart[id] && cart[id][0] > 1) {
        cart[id][0] -= 1;
      } else {
        delete cart[id];
      }
      updateCart(cart);
    });

    $('.plus').on('click', function() {
      let id = this.id.replace('plus', '');
      if (cart[id]) {
        cart[id][0] += 1;
      } else {
        console.error(`Cart item with ID ${id} does not exist.`);
      }
      updateCart(cart);
    });
  }

  function updatePopover(cart) {
    let popStr = "<h5>Your shopping cart</h5><div class='mx-2 my-2'>";
    let i = 1;

    for (let item in cart) {
      popStr += `<b>${i}.</b> ${cart[item][1].slice(0, 19)}... <b>${cart[item][0]}</b> Qty<br>`;
      i++;
    }

    popStr += "</div> <a href='/checkout'><button class='btn btn-primary' id='clearCart'>Go to Cart</button></a>";
    $('#popcart').attr('data-content', popStr).popover('show');
  }

  $('#popcart').popover();
});

    </script>
    {% endblock %}

    <!-- Remaining vendor scripts -->
    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'assets/vendor/aos/aos.js' %}"></script>
    <script src="{% static 'assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
    <script src="{% static 'assets/vendor/imagesloaded/imagesloaded.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/vendor/isotope-layout/isotope.pkgd.min.js' %}"></script>
    <script src="{% static 'assets/vendor/purecounter/purecounter_vanilla.js' %}"></script>
    
    <!-- Main JS File -->
    <script src="{% static 'assets/js/main.js' %}"></script>
  </body>
</html>